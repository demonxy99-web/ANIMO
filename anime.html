<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ANIMO – Anime</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDRDsqBFjIXp6mh8LO431Usd-Rmpw5pTDM",
  authDomain: "animo-ab129.firebaseapp.com",
  projectId: "animo-ab129",
  storageBucket: "animo-ab129.appspot.com",
  messagingSenderId: "806187073262",
  appId: "1:806187073262:web:28fb98cbf9a25a214ffdff"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

onAuthStateChanged(auth, user => {
  if (!user) {
    window.location.href = "index.html";
  } else {
    loadAnime();
  }
});

async function loadAnime() {
  const animeId = localStorage.getItem("animeId");
  if (!animeId) {
    alert("Anime not found");
    window.location.href = "home.html";
    return;
  }

  const ref = doc(db, "anime", animeId);
  const snap = await getDoc(ref);

  if (!snap.exists()) {
    alert("Anime deleted");
    window.location.href = "home.html";
    return;
  }

  const anime = snap.data();

  document.getElementById("title").innerText = anime.title;
  document.getElementById("poster").src = anime.poster;

  const container = document.getElementById("seasons");
  container.innerHTML = "";

  anime.seasons.forEach((season, sIndex) => {
    const sDiv = document.createElement("div");
    sDiv.className = "season";
    sDiv.innerHTML = `<h2>${season.name}</h2>`;

    season.episodes.forEach((ep, eIndex) => {
      const epDiv = document.createElement("div");
      epDiv.className = "episode";
      epDiv.innerText = ep.title;

      epDiv.onclick = () => {
        localStorage.setItem("videoUrl", ep.videoUrl);
        localStorage.setItem("videoType", ep.videoType);
        localStorage.setItem("epTitle", ep.title);
        window.location.href = "player.html";
      };

      sDiv.appendChild(epDiv);
    });

    container.appendChild(sDiv);
  });
}
</script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(180deg, #020617, #0b1220);
  color: white;
}

header {
  padding: 15px;
  font-size: 22px;
  font-weight: bold;
}

.back {
  padding: 10px;
  color: #60a5fa;
  cursor: pointer;
}

.anime {
  padding: 15px;
}

.anime img {
  width: 100%;
  max-height: 300px;
  object-fit: cover;
  border-radius: 12px;
}

.season {
  margin-top: 20px;
}

.season h2 {
  margin-bottom: 10px;
}

.episode {
  background: #0f172a;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 8px;
  cursor: pointer;
}

.episode:hover {
  background: #1e293b;
}
</style>
</head>

<body>

<header>ANIMO</header>
<div class="back" onclick="window.location.href='home.html'">← Back</div>

<div class="anime">
  <img id="poster">
  <h1 id="title"></h1>
</div>

<div id="seasons" class="anime"></div>

</body>
</html>