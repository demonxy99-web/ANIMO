<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ANIMO Admin</title>

<style>
body{margin:0;font-family:Arial;background:#0b1220;color:#fff}
header{padding:14px;background:#020617;text-align:center;font-size:20px;font-weight:bold}
.container{padding:14px}
input,button{width:100%;padding:10px;margin:6px 0;border:none;border-radius:6px}
button{background:#6366f1;color:#fff;font-weight:bold}
.card{background:#111827;padding:10px;border-radius:8px;margin-bottom:10px}
.small{font-size:12px;opacity:.7}
.hidden{display:none}
.danger{background:#ef4444}
.secondary{background:#334155}
hr{border:0;height:1px;background:#1f2937;margin:12px 0}
</style>
</head>

<body>

<header>ANIMO Admin App</header>

<div class="container">

<!-- LOGIN -->
<div id="loginBox">
  <input id="pass" placeholder="Admin Password">
  <button onclick="login()">Login</button>
</div>

<!-- ADMIN PANEL -->
<div id="panel" class="hidden">

  <h3>Add Anime</h3>
  <input id="aTitle" placeholder="Anime Title">
  <input id="aImage" placeholder="Poster Image URL">
  <button onclick="addAnime()">Add Anime</button>

  <hr>

  <h3>Anime List</h3>
  <div id="animeList"></div>

</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getFirestore, collection, addDoc, getDocs,
  deleteDoc, doc, updateDoc
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig={
  apiKey:"AIzaSyDRDsqBFjIXp6mh8LO431Usd-Rmpw5pTDM",
  authDomain:"animo-ab129.firebaseapp.com",
  projectId:"animo-ab129"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

// ðŸ” PASSWORD
const ADMIN_PASSWORD="admin123";

window.login=()=>{
  if(pass.value===ADMIN_PASSWORD){
    loginBox.classList.add("hidden");
    panel.classList.remove("hidden");
    loadAnime();
  } else {
    alert("Wrong password");
  }
};

// ðŸ“º ANIME
async function loadAnime(){
  animeList.innerHTML="";
  const snap=await getDocs(collection(db,"anime"));
  snap.forEach(d=>{
    const a=d.data();
    animeList.innerHTML+=`
      <div class="card">
        <b>${a.title}</b>
        <div class="small">${d.id}</div>
        <button onclick="addSeason('${d.id}')">Add Season</button>
        <button class="danger" onclick="delAnime('${d.id}')">Delete Anime</button>
        <div id="s-${d.id}"></div>
      </div>`;
    loadSeasons(d.id);
  });
}

window.addAnime=async()=>{
  if(!aTitle.value||!aImage.value)return;
  await addDoc(collection(db,"anime"),{
    title:aTitle.value,
    image:aImage.value
  });
  aTitle.value="";aImage.value="";
  loadAnime();
};

window.delAnime=async(id)=>{
  if(confirm("Delete anime?")){
    await deleteDoc(doc(db,"anime",id));
    loadAnime();
  }
};

// ðŸ“‚ SEASONS
window.addSeason=async(animeId)=>{
  const n=prompt("Season name");
  if(n){
    await addDoc(collection(db,"anime",animeId,"seasons"),{name:n});
    loadAnime();
  }
};

async function loadSeasons(animeId){
  const box=document.getElementById("s-"+animeId);
  box.innerHTML="";
  const snap=await getDocs(collection(db,"anime",animeId,"seasons"));
  snap.forEach(s=>{
    box.innerHTML+=`
      <div class="card">
        <b>${s.data().name}</b>
        <button onclick="addEpisode('${animeId}','${s.id}')">Add Episode</button>
        <button class="danger" onclick="delSeason('${animeId}','${s.id}')">Delete Season</button>
        <div id="e-${s.id}"></div>
      </div>`;
    loadEpisodes(animeId,s.id);
  });
}

window.delSeason=async(aid,sid)=>{
  if(confirm("Delete season?")){
    await deleteDoc(doc(db,"anime",aid,"seasons",sid));
    loadAnime();
  }
};

// ðŸŽ¬ EPISODES
window.addEpisode=async(aid,sid)=>{
  const t=prompt("Episode title");
  const v=prompt("Episode video URL");
  if(t&&v){
    await addDoc(
      collection(db,"anime",aid,"seasons",sid,"episodes"),
      {title:t,video:v}
    );
    loadAnime();
  }
};

async function loadEpisodes(aid,sid){
  const box=document.getElementById("e-"+sid);
  box.innerHTML="";
  const snap=await getDocs(
    collection(db,"anime",aid,"seasons",sid,"episodes")
  );
  snap.forEach(e=>{
    box.innerHTML+=`
      <div class="small">
        â–¶ ${e.data().title}
        <button class="danger" onclick="delEpisode('${aid}','${sid}','${e.id}')">
          Delete
        </button>
      </div>`;
  });
}

window.delEpisode=async(aid,sid,eid)=>{
  if(confirm("Delete episode?")){
    await deleteDoc(doc(db,"anime",aid,"seasons",sid,"episodes",eid));
    loadAnime();
  }
};
</script>

</body>
</html>